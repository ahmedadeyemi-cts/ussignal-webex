<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8" />
<title>US Signal | Webex Calling PSTN Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
 --bg:#f6f8fb;
 --card:#ffffff;
 --text:#0f172a;
 --muted:#64748b;
 --line:rgba(15,23,42,.10);
 --shadow:0 8px 24px rgba(15,23,42,.08);
 --accent:#0f62fe;
 --good:#16a34a;
 --warn:#f59e0b;
 --bad:#dc2626;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);display:flex;min-height:100vh}
.sidebar{width:260px;background:var(--card);border-right:1px solid var(--line);padding:18px;display:flex;flex-direction:column;gap:14px}
.sidebar a{padding:10px;border-radius:12px;font-weight:800;font-size:13px;text-decoration:none;color:var(--text)}
.sidebar a.active{background:rgba(15,98,254,.12);border:1px solid rgba(15,98,254,.2)}
.sidebarBottom{margin-top:auto;display:flex;flex-direction:column;gap:10px}
.summary-pill{padding:12px;border-radius:12px;font-weight:900;text-align:center}
.summary-green{background:rgba(22,163,74,.15);color:var(--good)}
.summary-amber{background:rgba(245,158,11,.15);color:var(--warn)}
.summary-red{background:rgba(220,38,38,.15);color:var(--bad)}
.main{flex:1;padding:22px;display:flex;flex-direction:column;gap:18px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:16px}
h2{margin:0 0 10px 0;font-size:14px;font-weight:1000}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.kpi{padding:12px;border-radius:14px;border:1px solid rgba(15,23,42,.08)}
.kpi .value{font-size:22px;font-weight:1100}
.table-wrap{border:1px solid var(--line);border-radius:16px;overflow:auto}
table{width:100%;border-collapse:collapse}
thead th{padding:10px;font-size:12px;color:var(--muted);text-transform:uppercase}
tbody td{padding:10px;border-top:1px solid rgba(15,23,42,.06);font-size:13px}
.badge{padding:4px 10px;border-radius:999px;font-size:11px;font-weight:900}
.badge.good{background:rgba(22,163,74,.15);color:var(--good)}
.badge.warn{background:rgba(245,158,11,.15);color:var(--warn)}
.badge.bad{background:rgba(220,38,38,.15);color:var(--bad)}
canvas{width:100%;height:160px}
</style>
</head>
<body>

<div class="sidebar">
 <a href="/customer">Dashboard</a>
 <a href="/customer/licenses">Licenses</a>
 <a href="/customer/devices">Devices</a>
 <a href="/customer/analytics">Analytics</a>
 <a href="/customer/cdr">CDR</a>
 <a href="/customer/pstn" class="active">PSTN</a>
 <div class="sidebarBottom">
   <div id="rag" class="summary-pill summary-green">GREEN</div>
   <button onclick="logout()">Logout</button>
 </div>
</div>

<div class="main">

<div class="card">
<h2>PSTN Global Health</h2>
<div class="grid">
 <div class="kpi"><div>Trunks</div><div id="kTrunks" class="value">—</div></div>
 <div class="kpi"><div>DIDs</div><div id="kDids" class="value">—</div></div>
 <div class="kpi"><div>Gateways</div><div id="kGateways" class="value">—</div></div>
 <div class="kpi"><div>Capacity Risk</div><div id="kRisk" class="value">—</div></div>
</div>
</div>

<div class="card">
<h2>Call Routing Simulation</h2>
<input id="simNumber" placeholder="Enter E.164 number">
<button onclick="simulate()">Simulate</button>
<div id="simResult"></div>
</div>

<div class="card">
<h2>Failover Path Validation</h2>
<div id="failover"></div>
</div>

<div class="card">
<h2>DID Inventory Reconciliation</h2>
<div id="didAudit"></div>
</div>

<div class="card">
<h2>SBC / Local Gateway Monitoring</h2>
<div id="gatewayStatus"></div>
</div>

<div class="card">
<h2>E911 Compliance Audit</h2>
<div id="e911Audit"></div>
</div>

<div class="card">
<h2>Fraud Pattern Detection</h2>
<div id="fraud"></div>
</div>

<div class="card">
<h2>Historical Trunk Utilization</h2>
<canvas id="trend"></canvas>
</div>

</div>

<script>
const $=id=>document.getElementById(id)

async function api(p){const r=await fetch(p);return r.json()}

async function init(){
 const me=await api("/api/me")
 const orgId=me.orgId

 const trunks=await api("/api/pstn/trunks?orgId="+orgId)
 const dids=await api("/api/pstn/dids?orgId="+orgId)
 const gateways=await api("/api/pstn/gateways?orgId="+orgId)
 const history=await api("/api/pstn/history?orgId="+orgId)
 const e911=await api("/api/pstn/e911?orgId="+orgId)

 $("kTrunks").textContent=trunks.length
 $("kDids").textContent=dids.length
 $("kGateways").textContent=gateways.length

 analyzeRisk(trunks)
 renderTrend(history)
 auditDids(dids)
 validateFailover(trunks)
 monitorGateways(gateways)
 auditE911(e911)
 detectFraud(history)
}

function analyzeRisk(trunks){
 let risk="GREEN"
 trunks.forEach(t=>{
   if(t.utilization>85) risk="RED"
   else if(t.utilization>70 && risk!=="RED") risk="AMBER"
 })
 $("kRisk").textContent=risk
 updateRAG(risk)
}

function updateRAG(state){
 const el=$("rag")
 el.className="summary-pill"
 if(state==="RED") el.classList.add("summary-red")
 else if(state==="AMBER") el.classList.add("summary-amber")
 else el.classList.add("summary-green")
 el.textContent=state
}

function simulate(){
 const number=$("simNumber").value
 $("simResult").textContent="Route lookup for "+number+" → Primary trunk A → Failover trunk B"
}

function validateFailover(trunks){
 $("failover").innerHTML=trunks.map(t=>
  "<div>"+t.name+" → "+(t.failover?"Failover OK":"No Backup")+"</div>").join("")
}

function auditDids(dids){
 const orphan=dids.filter(d=>!d.assigned)
 $("didAudit").innerHTML="Unassigned DIDs: "+orphan.length
}

function monitorGateways(gws){
 $("gatewayStatus").innerHTML=gws.map(g=>
  "<div>"+g.name+" → "+g.status+"</div>").join("")
}

function auditE911(e){
 $("e911Audit").textContent=e.compliant?"Compliant":"Non-Compliant"
}

function detectFraud(history){
 const spikes=history.filter(h=>h.calls>h.avg*2)
 $("fraud").textContent="Traffic spikes detected: "+spikes.length
}

function renderTrend(data){
 const c=$("trend")
 const ctx=c.getContext("2d")
 ctx.clearRect(0,0,c.width,c.height)
 ctx.strokeStyle="#0f62fe"
 ctx.beginPath()
 data.forEach((d,i)=>{
   const x=i*(c.width/data.length)
   const y=c.height-(d.calls/Math.max(...data.map(x=>x.calls)))*c.height
   if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y)
 })
 ctx.stroke()
}

function logout(){fetch("/api/logout",{method:"POST"}).finally(()=>location="/")}

init()
</script>
</body>
</html>
