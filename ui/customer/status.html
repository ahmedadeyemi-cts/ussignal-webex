<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>US Signal | Status Intelligence 5.0</title>

<style>
:root{
  --bg:#f6f8fb;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:rgba(15,23,42,.08);
  --shadow:0 10px 30px rgba(15,23,42,.08);

  --accent:#0f62fe;
  --good:#16a34a;
  --warn:#f59e0b;
  --bad:#dc2626;
}
html[data-theme="dark"]{
  --bg:#0b1220;
  --card:#0f172a;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --line:rgba(226,232,240,.10);
  --shadow:0 12px 36px rgba(0,0,0,.35);

  --accent:#3b82f6;
  --good:#22c55e;
  --warn:#fbbf24;
  --bad:#ef4444;
}
*{box-sizing:border-box;font-family:system-ui;}
body{margin:0;background:var(--bg);color:var(--text);}

.app{
  display:grid;
  grid-template-columns:260px 1fr;
  min-height:100vh;
}
.sidebar{
  background:var(--card);
  border-right:1px solid var(--line);
  padding:18px 14px;
}
.brand{
  display:flex;gap:12px;align-items:center;
  padding-bottom:14px;border-bottom:1px solid var(--line);
}
.brand img{height:38px;}
.nav{margin-top:14px;display:flex;flex-direction:column;gap:6px;}
.nav a{
  padding:10px;border-radius:12px;font-weight:800;
}
.nav a.active{
  background:rgba(15,98,254,.12);
  border:1px solid rgba(15,98,254,.25);
}
.nav a:hover{background:rgba(15,98,254,.08);}

.main{
  padding:22px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:16px;
  box-shadow:var(--shadow);
  padding:16px;
}

.headerCard{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title{font-size:18px;font-weight:1000;}
.meta{font-size:12px;color:var(--muted);margin-top:4px;}

button{
  background:var(--accent);
  border:none;
  color:white;
  padding:8px 14px;
  border-radius:10px;
  font-weight:900;
  cursor:pointer;
}
.btn-outline{
  background:transparent;
  border:1px solid var(--line);
  color:var(--text);
}

.banner{
  padding:14px;
  border-radius:14px;
  font-weight:900;
}
.banner.bad{background:rgba(220,38,38,.14);color:var(--bad);}
.banner.warn{background:rgba(245,158,11,.14);color:var(--warn);}

.kpiRow{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:12px;
}
.kpi{
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
}
.kpi .label{font-size:12px;color:var(--muted);font-weight:900;}
.kpi .value{font-size:20px;font-weight:1000;margin-top:6px;}

.pill{
  padding:6px 12px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
}
.good{background:rgba(22,163,74,.12);color:var(--good);}
.warn{background:rgba(245,158,11,.14);color:var(--warn);}
.bad{background:rgba(220,38,38,.14);color:var(--bad);}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:12px;
}

.serviceCard{
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  background:var(--card);
}
.serviceName{
  font-weight:1000;
  font-size:14px;
  margin-bottom:8px;
}
.component{
  font-size:12px;
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
}
.execBlock{
  font-size:14px;
  line-height:1.5;
}
</style>
</head>

<body>
<div class="app">

<div class="sidebar">
  <div class="brand">
    <img src="/assets/ussignal-logo.jpg"/>
    <div>
      <b>US Signal</b><br/>
      <span style="font-size:12px;color:var(--muted);">Customer Portal</span>
    </div>
  </div>
  <div class="nav">
    <a href="/customer">Dashboard</a>
    <a href="/customer/maintenance">Maintenance</a>
    <a class="active" href="/customer/status">Status</a>
    <a href="/customer/incidents">Incidents</a>
  </div>
</div>

<div class="main">

<div class="card headerCard">
  <div>
    <div class="title">Webex Global Status Intelligence</div>
    <div class="meta">
      Last Updated: <span id="lastUpdated">—</span>
    </div>
  </div>
  <div>
    <button class="btn-outline" onclick="toggleTheme()">Theme</button>
    <button onclick="refreshData()">Refresh</button>
  </div>
</div>

<div id="alertBanner"></div>

<div class="kpiRow">
  <div class="kpi">
    <div class="label">Overall</div>
    <div class="value"><span id="overallPill" class="pill">—</span></div>
  </div>
  <div class="kpi">
    <div class="label">Total Services</div>
    <div class="value" id="kServices">0</div>
  </div>
  <div class="kpi">
    <div class="label">Impacted Services</div>
    <div class="value" id="kImpacted">0</div>
  </div>
  <div class="kpi">
    <div class="label">Impacted Components</div>
    <div class="value" id="kComponents">0</div>
  </div>
  <div class="kpi">
    <div class="label">SLA Exposure Index</div>
    <div class="value" id="kRisk">0</div>
  </div>
</div>

<div class="card">
  <div class="execBlock" id="execSummary"></div>
</div>

<div class="card">
  <div class="grid" id="servicesGrid"></div>
</div>

</div>
</div>

<script>
let STATUS=null;

function toggleTheme(){
  const html=document.documentElement;
  html.setAttribute("data-theme",
    html.getAttribute("data-theme")==="dark"?"light":"dark");
}

async function refreshData(){
  const r=await fetch("/api/status",{cache:"no-store"});
  const data=await r.json();
  STATUS=data;
  render();
}

function render(){
  const groups=STATUS.components||[];

  document.getElementById("lastUpdated").textContent=
    new Date(STATUS.lastUpdated).toLocaleString();

  document.getElementById("kServices").textContent=groups.length;

  let impacted=0;
  let impactedComponents=0;

  groups.forEach(g=>{
    if(g.status!=="operational") impacted++;
    (g.children||[]).forEach(c=>{
      if(c.status!=="operational") impactedComponents++;
    });
  });

  document.getElementById("kImpacted").textContent=impacted;
  document.getElementById("kComponents").textContent=impactedComponents;

  const risk=(impacted*15)+(impactedComponents*3);
  document.getElementById("kRisk").textContent=risk;

  const overall=STATUS.overall||"operational";
  const pill=document.getElementById("overallPill");
  pill.textContent=overall.toUpperCase();
  pill.className="pill "+
    (overall==="operational"?"good":
     overall==="degraded_performance"?"warn":"bad");

  const banner=document.getElementById("alertBanner");
  banner.innerHTML="";
  if(overall!=="operational"){
    banner.innerHTML=`<div class="banner ${
      risk>50?"bad":"warn"}">
      Webex service degradation detected.
    </div>`;
  }

  buildExecutive(overall, impacted, impactedComponents, risk);
  renderServices(groups);
}

function buildExecutive(o,s,c,r){
  let text="All Webex services operational.";
  if(o!=="operational"){
    text=`${s} services degraded impacting ${c} components. `;
    text+=`SLA exposure index ${r}. Customer impact may vary by workload.`;
  }
  document.getElementById("execSummary").textContent=text;
}

function renderServices(groups){
  const host=document.getElementById("servicesGrid");
  host.innerHTML="";

  groups.sort((a,b)=>{
    if(a.status==="operational" && b.status!=="operational") return 1;
    if(a.status!=="operational" && b.status==="operational") return -1;
    return 0;
  });

  groups.forEach(g=>{
    const card=document.createElement("div");
    card.className="serviceCard";

    const pillClass=
      g.status==="operational"?"good":
      g.status==="degraded_performance"?"warn":"bad";

    card.innerHTML=`
      <div class="serviceName">
        ${g.name}
        <span class="pill ${pillClass}">${g.status}</span>
      </div>
      ${(g.children||[]).map(c=>`
        <div class="component">
          <span>${c.name}</span>
          <span class="pill ${
            c.status==="operational"?"good":
            c.status==="degraded_performance"?"warn":"bad"}">
            ${c.status}
          </span>
        </div>
      `).join("")}
    `;

    host.appendChild(card);
  });
}

setInterval(refreshData,60000);
refreshData();
</script>
</body>
</html>
